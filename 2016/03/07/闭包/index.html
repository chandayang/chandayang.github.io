<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>闭包 | chandayang&#39;s blog</title>
  <meta name="description" content="前端程序媛一枚" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <meta name="generator" content="chandayang's blog">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  

  

</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2016/03/08/js中的this/">js中的this</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2016/03/07/闭包/">闭包</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2016/02/27/hello-world/">Hello World</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li class="mp-pjax"><a class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2016/03/08/js中的this/">js中的this</a>
                
                    <a  data-pjax href="/2016/03/07/闭包/">闭包</a>
                
                    <a  data-pjax href="/2016/02/27/hello-world/">Hello World</a>
                
                
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" data-pjax href="/">chandayang&#39;s blog</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">闭包</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">闭包</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2016-03-07T08:33:50.000Z"
                              itemprop="datePublished">2016-03-07</time>
                    </div>
    </span>

        <section class="post-content">
            <!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <style>
    *{padding:0;margin:0;}
    body{
      
      margin:0 auto;
      font-family: "Verdana";
      background-color:  #22c3aa;
      color: #333;
       font-family: "Microsoft YaHei",sans-serif;
       font-size: 1.1rem;
       font-weight: 400;
       overflow-x: hidden;
       text-align: left;
      line-height: 2.2rem;
    }
    .wrap{
      background-color: white;
      margin:10px 20px 0 20px;  
      text-indent:2em;
      padding:5px 5px 5px 5px;  
      position:relative;  
      border-radius: 20px;
    }
    h2{
      color:#F47171;
      font-size:3rem;
      
    }
    .space{
      height:20px;
    }
    blockquote{
      background-color:#F47171;
      padding:0 0 0 20px;
      height:40px;
      width:300px;
      border-radius: 3px;
    }
    .title{
      background-color:  #71F4D8;
      line-height: 40px;
      height:40px;
      font-size:14px;
    }
    pre{
      text-align: left;
      text-indent:0;
    }
    .closure{
      text-indent: 0
    }
    .closure dl dt{
      font-weight: bold;
    }
        </style>
    </head>
    <body>
    <div class="wrap">
       <h2>闭包的“恩怨情仇”</h2>
       <div class="space"></div>
      <hr style="FILTER: alpha(opacity=100,finishopacity=0,style=2)" width="100%" color="#F47171" size="10">
      <div class="space"></div>
          <p class="preface">一直以来觉得“闭包”好麻烦，虽然很多时候无形之中都在用闭包，但是并没有很透彻的了解闭包到底是什么，也没有从根本上探究过“闭包”，作为一名“前端程序媛”，我认为这时十分危险的。所以，经过几天的学习，参考了一些博客、书籍，终于让我对闭包有了一个较为清晰的了解，这篇博客从函数的作用域讲起，然后直到闭包，自认为是众多资料中一个较为清晰的思路。
          </p>
        <div class="scope">     
        <dl>
          <dt><blockquote>
            <h5 class="title">1.全局作用域</h5>
            </blockquote>
          </dt>
          <dd>所有浏览器都支持 window 对象，它表示浏览器窗口，JavaScript 全局对象、函数以及变量均自动成为 window 对象的成员。所以，全局变量是 window 对象的属性，全局函数是 window 对象的方法，甚至 HTML DOM 的 document 也是 window 对象的属性之一。<br>
          全局变量是JavaScript里生命周期（一个变量多长时间内保持一定的值）最长的变量，其将跨越整个程序，可以被程序中的任何函数方法访问。
          在全局下声明的变量都会在window对象下，都在全局作用域中，我们可以通过window对象访问，也可以直接访问。          
<pre>var name = "jeri";
console.log(window.name); // 输出:jeri
console.log(name); // 输出:jeri
</pre>
<pre>function fun() {
name = "jeri";
alert(name);
}            
console.log(name); // 输出:jeri 
</pre>  
          全局变量存在于整个函数的生命周期中，然而其在全局范围内很容易被篡改，我们在使 用全局变量时一定要小心，尽量不要使用全局变量。在函数内部声明变量没有使用var也会产生全局变量，会为我们造成一些混乱，比如变量覆盖等。所以，我们 在声明变量的任何时候最好都要带上var。
          全局变量存在于程序的整个生命周期，但并不是通过其引用我们一定可以访问到全局变量。
          </dd>
          <blockquote>
            <h5 class="title">2.词法作用域</h5>
          </blockquote>
          <dd>词法作用域：函数在定义它们的作用域里运行，而不是在执行它们的作用域里运行。也就是说词法作用域取决于源码，通过静态分析就能确定，因此词法作用域也叫做静态作用域。with和eval除外，所以只能说JS的作用域机制非常接近词法作用域（Lexicalscope）。词法作用域也可以理解为一个变量的可见性，及其文本表述的模拟值。
<pre>
 var name = "global"; 
function fun() {
var name = "jeri";
return name;
 }
console.log(fun()); // 输出:jeri
console.log(name); // 输出:global
</pre>        
          在通常情况下，变量的查询从最近接的绑定上下文开始，向外部逐渐扩展，直到查询到第一个绑定，一旦完成查找就结束搜索。就像上例，先查找离它最近的name="jeri"，查询完成后就结束了，将第一个获取的值作为变量的值。
          </dd>
          <blockquote>
              <h5 class="title">3.动态作用域</h5>
          </blockquote>
          <dd>在编程实践中，最容易低估和过度滥用的概念就是动态作用域，因为很少有语言支持这种方式为绑定解析方案。
动态作用域与词法作用域相对而言的，不同于词法作用域在定义时确定，动态作用域在执行时确定，其生存周期到代码片段执行为止。动态变量存在于动态作用域中，任何给定的绑定的值，在确定调用其函数之前，都是不可知的。
在代码执行时，对应的作用域链常常是保持静态的。然而当遇到with语句、 call方法、apply方法和try-catch中的catch时，会改变作用域链的。以with为例，在遇到with语句时，会将传入的对象属性作为 局部变量来显示，使其便于访问，也就是说把一个新的对象添加到了作用域链的顶端，这样必然影响对局部标志符的解析。当with语句执行完毕后，会把作用域链恢复到原始状态。实例如下
<pre>
var name = "global";
 // 使用with之前
console.log(name); // 输出:global 
with({name:"jeri"}){
console.log(name); // 输出:jeri
}
// 使用with之后，作用域链恢复
console.log(name); // 输出:global 
</pre>  
  <p>
  在作用域链中有动态作用域时，this引用也会变得更加复杂，不再指向第一次创建时的上下文，而是由调用者确定。比如在使用apply或call方法时，传入它们的第一个参数就是被引用的对象。实例如下：  
  </p>            
<pre>
function globalThis() {
console.log(this);
}             
globalThis(); // 输出:Window {document: document,external: Object…}
globalThis.call({name:"jeri"}); // 输出:Object {name: "jeri"}
globalThis.apply({name:"jeri"},[]); // 输出:Object {name: "jeri"}
</pre>
          </dd>
          <blockquote>
            <h5 class="title">4.函数作用域</h5>
          </blockquote>
          <dd>
          函数作用域，顾名思义就是在定义函数时候产生的作用域，这个作用域也可以称为局部作用域。和全局作用域相反，函数作用域一般只在函数的代码片段内可访问到，外部不能进行变量访问。在函数内部定义的变量存在于函数作用域中，其生命周期随着函数的执行结束而结束。实例如下：
<pre>
var name = "global";
function fun() {
var name = "jeri";
console.log(name); // 输出:jeri
with ({name:"with"}) {
console.log(name); // 输出:with
}
console.log(name); // 输出:jeri
}
fun();
// 不能访问函数作用域
console.log(name); // 输出:global
</pre>
              
            </dd></dl></div>
          
          <blockquote>
            <h5 class="title">5.没有块级作用域</h5>
          </blockquote>
          <dd>
            不同于其他编程语言，在JavaScript里并没有块级作用域，也就是说在for、if、while等语句内部的声明的变量与在外部声明是一样的，在这些语句外部也可以访问和修改这些变量的值。实例如下：
<pre>
function fun() {
if(0 < 2) {
var name = "jeri";
}    
console.log(name); // 输出:jeri
name = "change";
console.log(name); // 输出:change
}
fun();
</pre>
          </dd>
          <blockquote>
              <h5 class="title">6.作用域链</h5>
          </blockquote>
          <dd>JavaScript里一切皆为对象，包括函数。函数对象和其它对象一样，拥有可以通过代码访问的属性和一系列仅供JavaScript引擎访问的内部属性。其中一个内部属性是作用域，包含了函数被创建的作用域中对象的集合，称为函数的作用域链，它用来保证对执行环境有权访问的变量和函数的有序访问。
          当一个函数创建后，它的作用域链会被创建此函数的作用域中可访问的数据对象填充。在全局作用域中创建的函数，其作用域链会自动成为全局作用域中的一员。而当函数执行时，其活动对象就会成为作用域链中的第一个对象（活 动对象：对象包含了函数的所有局部变量、命名参数、参数集合以及this）。在程序执行时，Javascript引擎会通过搜索上下文的作用域链来解析诸 如变量和函数名这样的标识符。其会从作用域链的最里面开始检索，按照由内到外的顺序，直到完成查找，一旦完成查找就结束搜索。如果没有查询到标识符声明，则报错。当函数执行结束，运行期上下文被销毁，活动对象也随之销毁。实例如下：
<pre>
var name = 'global';  
function fun() {
console.log(name); // output:global
name = "change";
// 函数内部可以修改全局变量
console.log(name); // output:change
// 先查询活动对象
var age = "18";
console.log(age); // output:18
}
fun();
// 函数执行完毕，执行环境销毁
console.log(age); // output:Uncaught ReferenceError: age is not defined             
</pre>      
          </dd>
        
          <blockquote>          
            <h5 class="title">7.闭包</h5>
          </blockquote>
          <dl>
            <dt>定义：
              <dd>我所理解的闭包是指一个可以访问另一个函数作用域中的变量的函数</dd>
            </dt>
            <dt>闭包作用:
              <dd>可以读取函数内部的变量；
          让这些变量的值始终保持在内存中；
          可以用于创建私有函数或方法。
          保护命名空间
          避免污染全局变量
          </dd>
            </dt>
            <dt> 使用闭包的注意点:
              <dd>1）  由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。
           <br>
          2）闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。
          </dd>
            </dt>
            <dt>
                 闭包实例：
                 <dd>
<pre>
var person=function() {
var _name="default";
return {
getName:function() {
return _name;
},
setName:function(newName) {
_name=newName;
}
}
}();
alert(person._name);//undefined
alert(person.getName());//default
person.setName("dierbaby");
alert(person.getName());//dierbaby


function person() {
var _name="default";
this.getName=function() {
return _name;
};
this.setName=function(newName) {
_name=newName;
};
};
var guokai=new person();
alert(guokai._name);//undefined
alert(guokai.getName());//default
guokai.setName("guokai");
alert(guokai.getName());//guokai


for(var i=0; i<5;i++){ settimeout(function(){="" console.log(i)="" },1000);="" }="" 上面只是保存一个索引="" for(var="" i="0;" <="" 5;="" i++)="" {="" (function(j)="" settimeout(function()="" console.log(j);="" },="" 1000);="" })(i);="" 下面这个表示匿名函数立即执行，而且i是实参，j是形参="" pre="">                   

                 </5;i++){></pre></dd>
            </dt>
          </dl>
          <p></p>        
        </div>
    </body>
</html>
        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/2016/03/08/js中的this/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/2016/02/27/hello-world/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; chandayang's blog 2014</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>
    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>
  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>







</body>
</html>
